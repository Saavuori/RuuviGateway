version: "3.5"
services:
  ruuvigateway:
    build: .
    image: ruuvi-go-gateway:local
    container_name: ruuvi-go-gateway
    restart: unless-stopped
    ports:
      - "8080:8080"

    # NET_ADMIN capability is often required for BLE scanning operations.
    cap_add:
      - NET_ADMIN

    # Device mapping is typically NOT needed if using network_mode: host and the internal HCI.
    # If using an external USB dongle and NOT using network_mode: host, you might map it,
    # but 'github.com/rigado/ble' usually expects host networking for raw socket access.
    # devices:
    #   - "/dev/bus/usb/002/001:/dev/bus/usb/002/001" 

    volumes:
      - ./config.yml:/app/config.yml

  ruuvi-matter-bridge:
    build: ./matter-bridge
    image: ruuvi-matter-bridge:local
    container_name: ruuvi-matter-bridge
    restart: unless-stopped
    ports:
      - "5540:5540/tcp"
      - "5540:5540/udp"
      - "5353:5353/udp"
    environment:
      - CONFIG_PATH=/app/config.yml
      - STORAGE_PATH=/data
      - GATEWAY_API=http://ruuvigateway:8080/api/tags
    volumes:
      - ./config.yml:/app/config.yml
      - ./matter_data:/data
